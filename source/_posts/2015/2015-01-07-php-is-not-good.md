---
title: 为什么 PHP 不好用
alias: '1992'
tags:
  - PHP
date: 2015-01-07
---

我之前写过很久 PHP, 但现在是 PHP 黑，简单说一下原因。

* 语法设计不合理

    这个诚然有历史原因，但确实是不合理。

    * 命名空间用（`\`）分隔，简直丧心病狂；对象成员用（`->`）访问，略显繁琐
    * 函数名不区分大小写，老版本的类名也不区分大小写，而变量名却区分大小写
    * 数组的写法繁琐（`array()`），直到 5.4 才有简写语法（`[]`）
    * 这样`function test_array(array $input_array)`, 可以限制参数的类型，适用于类和数组，却不适用于 `int` 和 `string`
    * `unset`, `echo`, `empty`, `list` 长得像函数，却不是函数
    * 直到 5.4 才支持 `func()[0]` 这种写法
    * 大部分内部函数默认不会抛出异常，导致 PHP 中存在两套独立的错误处理机制

* 很多被弃用的功能仍被广泛使用，新的功能被普及得很慢

    这个是使用者的事情，但情况就是如此。

    在开源软件中更为突出，比如 WordPress 为了尽可能兼容旧的 PHP 版本，没法用上例如匿名函数(5.3), 数组简写语法(5.4) 这种能够大幅改善代码可读性的功能。

    下面是一些被弃用的功能，这些功能大多是设计上存在失误，后来因为可能导致潜在的问题被弃用，但因为网络上互相转载的一些不靠谱教程，所以很多人依然在使用。

    * `__autoload`
    * `mysql_*` 系列函数
    * Register Globals
    * Magic Quotes
    * Safe Mode

* 缺少好用的包管理器和依赖管理方案

    PHP 和 Python, Ruby, Node.js 在使用领域上是有一定重叠的，我们来比较一下包的数量：

    * PHP Composer: 46k
    * Python PyPI: 53k
    * Ruby Gems: 94k
    * Node.js NPM: 116k

    虽然包的数量不代表质量，但是代表了人们是否愿意发布和使用包。

    Composer 在 PHP 中的普及率恐怕不及上面其他三款包管理器，比如作为最火的博客程序 WordPress, 和国内的 Typecho 都没有使用 Composer, 而是直接在源代码中包含所有依赖。

* 必须为每个请求创建一个单独的进程

    PHP 必须为每个请求创建一个进程（或线程），这导致在高并发的情况下会占用大量内存。

    在 PHP 中很难创建一个资源，并让它可以在全局范围内，可以被所有请求访问到，只能通过外部的数据库或缓存来实现。亦没有办法定义一项任务，独立于其他请求运行，只能通过单独的任务队列来解决。虽然这两个问题并不严重，但无法轻量级地维护全局的状态，算是一个缺憾。

* PHP 是为 Web 优化的编程语言

    * 可以直接用 `$_GET` 和 `$_POST` 访问来自客户端的 GET 和 POST 数据
    * 可以用 `<?php ?>` 的方式嵌入到 HTML 文件中

    现在大多数 Web 程序，往往都是 MVC 架构，在这种架构下，具有额外语法糖的 PHP 并不会比通用编程语言更好用。

    相反的方面，虽然 PHP 可以用于 Web 之外的场景，但坑实在是多。例如缺少好用的异步流程控制的方案等。
